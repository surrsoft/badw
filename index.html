<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="icon" href="data:,">
    <title>badw-project</title>
</head>
<body>
<div>Hello</div>
<div id="badw_version"></div>

<!-- https://github.com/jvilk/BrowserFS -->

<script src="./js/browserfs.min.js"></script>
<script src="./js/dropbox-js-james/dropbox-js.js"></script>
<script src="./js/dropbox-poem/paem-dropbox-js.js"></script>
<script>
  const BADW_VERSION = '0.0.11'
  BADW_FILE_NAME='/test-file-2.txt'
  const DBX_CLIENT_ID = 'e67evkn1n9gqpab'
  const DBX_REDIRECT_URI = 'https://surrsoft.github.io/badw/'

  function nx() {
    BrowserFS.install(window)
    // создание файловой системы с помощью указанной конфигурации, и инициализация BrowserFS
    // ей. См. тип FileSystemConfigureation для большей информации о конфигурационном объекте
    // https://github.com/jvilk/BrowserFS/blob/a96aa2d417995dac7d376987839bc4e95e218e06/src/core/browserfs.ts#L84
    BrowserFS.configure(
      {
        // ^ type FileSystemConfiguration (see https://github.com/jvilk/BrowserFS/blob/73e4eca717/src/core/browserfs.ts#L116)
        fs: 'Dropbox',
        options: {
          client: dropbox,
        },
      },
      function (e) {
        if (e) {
          throw e
        }
        console.log('-i- BrowserFS is ready!')
      },
    )

    // ---
    const testFile = 'text.txt'
    var fs = BrowserFS.BFSRequire('fs')
    fs.writeFile(
      testFile,
      'Cool, I can do this in the browser!',
      function (err) {
        fs.readFile(testFile, function (err, contents) {
          console.log('!! contents::', contents.toString())
        })
        if (err) {
          console.log('!! err', err)
        }
      },
    )
  }

  function ny() {
    console.log(`!!-!!-!! -> :::::::::::::: ny() {201219083258}:${Date.now()}`); // del+
    paemDropboxFileDownload(BADW_FILE_NAME)
      .then(function (fileContent) {
        console.log('!!-!!-!! fileContent {201219083247}\n', fileContent); // del+
      })
      .catch(function (err) {
        console.log('!!-!!-!! dropbox download: err {200322081417}\n', err);
      })
  }

  paemDropboxAuth(DBX_CLIENT_ID, DBX_REDIRECT_URI)
    .then(function () {
      console.log('BADW: SUCCESS: successfully Dropbox authenticated')
      try {
        // nx();
        ny();
      } catch (err) {
        console.log('BADW: ERR browser-fs: err {201217082657}\n', err); // del+
      }
    })
    .catch(function (err) {
      console.log('BADW: ERR: dropbox auth: err {200322073417}\n', err)
    })
</script>

<script>
  document.getElementById('badw_version').innerText = BADW_VERSION
</script>
</body>
</html>
